<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é£²æ–™æ—¥è¨˜ 2026</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glass-card { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.3); }
        body { -webkit-tap-highlight-color: transparent; font-family: -apple-system, sans-serif; background-color: #f5f0f2; }
        input { font-size: 16px !important; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const sugarLevels = ["å…¨ç³–", "å°‘ç³–", "åŠç³–", "å¾®ç³–", "ç„¡ç³–"];
        const iceLevels = ["æ­£å¸¸", "å°‘å†°", "å¾®å†°", "å»å†°", "ç†±"];

        function App() {
            // å„²å­˜ Google ç¶²å€åœ¨æœ¬åœ°ï¼Œé€™æ¨£æ¯å€‹äººå¯ä»¥è¨­å®šè‡ªå·±çš„
            const [gasUrl, setGasUrl] = useState(() => localStorage.getItem('user_gas_url') || '');
            const [drinkData, setDrinkData] = useState(() => JSON.parse(localStorage.getItem('myDrinkLogs_v4') || '{}'));
            const [curYear, setCurYear] = useState(2026);
            const [curMonth, setCurMonth] = useState(0); 
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [isSettingOpen, setIsSettingOpen] = useState(false);
            const [activeDateKey, setActiveDateKey] = useState("");
            const [isSaving, setIsSaving] = useState(false);
            const [editData, setEditData] = useState({ cup1: { item: '', price: '' }, cup2: { item: '', price: '' } });

            useEffect(() => { localStorage.setItem('myDrinkLogs_v4', JSON.stringify(drinkData)); }, [drinkData]);
            useEffect(() => { localStorage.setItem('user_gas_url', gasUrl); }, [gasUrl]);

            const formatDateKey = (y, m, d) => `${y}-${String(m + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;

            const handleSave = async () => {
                setIsSaving(true);
                try {
                    if (gasUrl) {
                        await fetch(gasUrl, {
                            method: 'POST',
                            mode: 'no-cors',
                            body: JSON.stringify({ date: activeDateKey, cup1: editData.cup1, cup2: editData.cup2 })
                        });
                    }
                    const newDrinkData = { ...drinkData };
                    if (editData.cup1.item || editData.cup2.item) newDrinkData[activeDateKey] = editData;
                    else delete newDrinkData[activeDateKey];
                    setDrinkData(newDrinkData);
                    setIsModalOpen(false);
                } catch (e) { alert('åŒæ­¥å¤±æ•—ï¼Œä½†å·²å­˜åœ¨æ‰‹æ©Ÿ'); }
                finally { setIsSaving(false); }
            };

            const daysInMonth = new Date(curYear, curMonth + 1, 0).getDate();
            const firstDayOfMonth = new Date(curYear, curMonth, 1).getDay();

            return (
                <div className="min-h-[100dvh] p-5">
                    <div className="max-w-md mx-auto relative">
                        {/* å³ä¸Šè§’è¨­å®šæŒ‰éˆ• */}
                        <button onClick={() => setIsSettingOpen(true)} className="absolute right-0 top-4 text-xl opacity-40">âš™ï¸</button>

                        <header className="text-center mb-8 pt-4">
                            <h1 className="text-3xl font-black text-[#8a7a82] tracking-tighter">é£²æ–™æ—¥è¨˜</h1>
                            <p className="text-[10px] opacity-40 uppercase tracking-widest">Personal Drink Tracker</p>
                        </header>

                        <div className="glass-card rounded-[35px] p-6 shadow-sm">
                            <div className="flex justify-between items-center mb-6">
                                <button onClick={() => setCurMonth(m => m === 0 ? 11 : m - 1)} className="p-2">â‡ </button>
                                <h2 className="font-bold text-lg">{curYear} / {curMonth + 1}</h2>
                                <button onClick={() => setCurMonth(m => m === 11 ? 0 : m + 1)} className="p-2">â‡¢</button>
                            </div>

                            <div className="grid grid-cols-7 gap-2">
                                {Array.from({ length: firstDayOfMonth }).map((_, i) => <div key={i} />)}
                                {Array.from({ length: daysInMonth }).map((_, i) => {
                                    const d = i + 1;
                                    const key = formatDateKey(curYear, curMonth, d);
                                    return (
                                        <div key={d} onClick={() => {
                                            setActiveDateKey(key);
                                            setEditData(drinkData[key] || { cup1: { item: '', price: '' }, cup2: { item: '', price: '' } });
                                            setIsModalOpen(true);
                                        }} className="aspect-square flex flex-col items-center justify-center relative rounded-2xl active:bg-white transition-all">
                                            <span className="text-[10px] absolute top-1.5 left-2 opacity-20">{d}</span>
                                            {drinkData[key] && <span className="text-xl">ğŸ§‹</span>}
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {/* è¨­å®šå½ˆçª— */}
                        {isSettingOpen && (
                            <div className="fixed inset-0 z-[60] flex items-center justify-center p-6 bg-black/60 backdrop-blur-md">
                                <div className="bg-white w-full rounded-[30px] p-8">
                                    <h3 className="font-bold mb-4 text-[#8a7a82]">åŒæ­¥è¨­å®š</h3>
                                    <p className="text-xs text-gray-400 mb-4">è«‹è²¼ä¸Šæ‚¨çš„ Google Apps Script ç¶²å€ï¼š</p>
                                    <textarea 
                                        className="w-full p-4 bg-gray-50 rounded-xl text-xs border-none h-32 mb-4"
                                        placeholder="https://script.google.com/macros/s/..."
                                        value={gasUrl}
                                        onChange={(e) => setGasUrl(e.target.value)}
                                    />
                                    <button onClick={() => setIsSettingOpen(false)} className="w-full bg-[#8a7a82] text-white py-4 rounded-2xl font-bold">å„²å­˜ä¸¦è¿”å›</button>
                                </div>
                            </div>
                        )}

                        {/* ç·¨è¼¯å½ˆçª— */}
                        {isModalOpen && (
                            <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4 bg-black/20 backdrop-blur-sm">
                                <div className="bg-white w-full max-w-sm rounded-[35px] p-6 shadow-2xl animate-in slide-in-from-bottom duration-300">
                                    <div className="flex justify-between items-center mb-6">
                                        <h3 className="font-bold text-[#8a7a82]">{activeDateKey}</h3>
                                        <button onClick={() => setIsModalOpen(false)} className="text-gray-300">âœ•</button>
                                    </div>
                                    {[1, 2].map(n => (
                                        <div key={n} className="mb-4 p-4 bg-gray-50 rounded-2xl">
                                            <p className="text-[10px] font-bold text-gray-400 mb-2 uppercase">Cup {n}</p>
                                            <input placeholder="å“é …åç¨±" value={editData[`cup${n}`].item} onChange={e => setEditData({...editData, [`cup${n}`]: {...editData[`cup${n}`], item: e.target.value}})} className="w-full p-3 mb-2 rounded-xl border-none shadow-sm" />
                                            <input placeholder="åƒ¹æ ¼" type="number" value={editData[`cup${n}`].price} onChange={e => setEditData({...editData, [`cup${n}`]: {...editData[`cup${n}`], price: e.target.value}})} className="w-full p-3 rounded-xl border-none shadow-sm" />
                                        </div>
                                    ))}
                                    <button onClick={handleSave} disabled={isSaving} className="w-full mt-4 bg-[#8a7a82] text-white py-4 rounded-[22px] font-bold shadow-lg">
                                        {isSaving ? 'åŒæ­¥ä¸­...' : gasUrl ? 'å„²å­˜ä¸¦åŒæ­¥é›²ç«¯' : 'å„²å­˜æ–¼æœ¬åœ°æ‰‹æ©Ÿ'}
                                    </button>
                                    {!gasUrl && <p className="text-[10px] text-center mt-2 text-red-400">å°šæœªè¨­å®š Google ç¶²å€ï¼Œè³‡æ–™åƒ…å­˜æ–¼æ‰‹æ©Ÿ</p>}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>